/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { isNull } from './object';
/**
 * @param {?} opts
 * @return {?}
 */
export function toPoint(opts) {
    if (!opts) {
        return new window.BMap.Point();
    }
    return new window.BMap.Point(opts.lng, opts.lat);
}
/**
 * @param {?} opts
 * @return {?}
 */
export function toPoints(opts) {
    if (!opts) {
        return [];
    }
    return opts.map(p => {
        return new window.BMap.Point(p.lng, p.lat);
    });
}
/**
 * @param {?} opts
 * @return {?}
 */
export function toSize(opts) {
    if (!opts) {
        return new window.BMap.Size();
    }
    return new window.BMap.Size(opts.width, opts.height);
}
/**
 * @param {?} url
 * @param {?} size
 * @param {?} options
 * @return {?}
 */
export function toIcon(url, size, options) {
    if (!size && !options) {
        return new window.BMap.Icon(url);
    }
    if (!size) {
        return new window.BMap.Icon(url, toSize(size));
    }
    const /** @type {?} */ iconOptions = {
        anchor: toSize(options.anchor),
        imageOffset: toSize(options.imageOffset),
        infoWindowAnchor: toSize(options.infoWindowAnchor),
        printImageUrl: options.printImageUrl
    };
    const /** @type {?} */ icon = new window.BMap.Icon(url, toSize(size), iconOptions);
    if (options.imageSize) {
        icon.setImageSize(toSize(options.imageSize));
    }
    return icon;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toMarkerOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (options.offset) {
        opts.offset = toSize(options.offset);
    }
    if (options.icon) {
        opts.icon = toIcon(options.icon.imageUrl, options.icon.size, options.icon);
    }
    if (!isNull(options.enableMassClear)) {
        opts.enableMassClear = options.enableMassClear;
    }
    if (!isNull(options.enableDragging)) {
        opts.enableDragging = options.enableDragging;
    }
    if (!isNull(options.enableClicking)) {
        opts.enableClicking = options.enableClicking;
    }
    if (!isNull(options.raiseOnDrag)) {
        opts.raiseOnDrag = options.raiseOnDrag;
    }
    if (!isNull(options.draggingCursor)) {
        opts.draggingCursor = options.draggingCursor;
    }
    if (!isNull(options.rotation)) {
        opts.rotation = options.rotation;
    }
    if (!isNull(options.title)) {
        opts.title = options.title;
    }
    if (!isNull(options.shadow)) {
        opts.shadow = toIcon(options.shadow.imageUrl, options.shadow.size, options.shadow);
    }
    return opts;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toNavigationControlOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.enableGeolocation)) {
        opts.enableGeolocation = options.enableGeolocation;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.showZoomInfo)) {
        opts.showZoomInfo = options.showZoomInfo;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    return opts;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toOverviewMapControlOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.isOpen)) {
        opts.isOpen = options.isOpen;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.size)) {
        opts.size = toSize(options.size);
    }
    return opts;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toScaleControlOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    return opts;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toMapTypeControlOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    return opts;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toGeolocationOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.enableAutoLocation)) {
        opts.enableAutoLocation = options.enableAutoLocation;
    }
    if (!isNull(options.locationIcon)) {
        opts.locationIcon = toIcon(options.locationIcon.imageUrl, options.locationIcon.size, options.locationIcon);
    }
    if (!isNull(options.showAddressBar)) {
        opts.showAddressBar = options.showAddressBar;
    }
    return opts;
}
/**
 * @param {?} style
 * @return {?}
 */
export function toTextIconStyle(style) {
    const /** @type {?} */ realStyle = {
        url: style.url,
        size: toSize(style.size)
    };
    if (style.anchor) {
        realStyle.anchor = toSize(style.anchor);
    }
    if (style.offset) {
        realStyle.offset = toSize(style.offset);
    }
    if (!isNull(style.textSize)) {
        realStyle.textSize = style.textSize;
    }
    if (!isNull(style.textColor)) {
        realStyle.textColor = style.textColor;
    }
    return realStyle;
}
/**
 * @param {?} options
 * @return {?}
 */
export function toMarkerClustererOptions(options) {
    const /** @type {?} */ opts = {};
    if (!options) {
        return opts;
    }
    if (options.markers) {
        opts.markers = options.markers.map(m => new window.BMap.Marker(toPoint(m.point), toMarkerOptions(m.options)));
    }
    if (!isNull(options.girdSize)) {
        opts.girdSize = options.girdSize;
    }
    if (!isNull(options.maxZoom)) {
        opts.maxZoom = options.maxZoom;
    }
    if (!isNull(options.minClusterSize)) {
        opts.minClusterSize = options.minClusterSize;
    }
    if (!isNull(options.isAverangeCenter)) {
        opts.isAverangeCenter = options.isAverangeCenter;
    }
    if (options.styles) {
        opts.styles = options.styles.filter(s => s).map(s => toTextIconStyle(s));
    }
    return opts;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1iYWlkdS1tYXAvIiwic291cmNlcyI6WyJoZWxwZXJzL3RyYW5zZm9ybWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFpQkEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQTs7Ozs7QUFJakMsTUFBTSxrQkFBa0IsSUFBVztJQUNqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO0tBQy9CO0lBQ0QsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7Q0FDakQ7Ozs7O0FBRUQsTUFBTSxtQkFBbUIsSUFBa0I7SUFDekMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1YsTUFBTSxDQUFDLEVBQUUsQ0FBQTtLQUNWO0lBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDbEIsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDM0MsQ0FBQyxDQUFBO0NBQ0g7Ozs7O0FBRUQsTUFBTSxpQkFBaUIsSUFBVTtJQUMvQixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0tBQzlCO0lBQ0QsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMs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aW9ucyxcbiAgQk1hcFR5cGVDb250cm9sT3B0aW9ucyxcbiAgQk5hdmlnYXRpb25Db250cm9sT3B0aW9ucyxcbiAgQk92ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMsXG4gIEJTY2FsZUNvbnRyb2xPcHRpb25zLFxuICBHZW9sb2NhdGlvbkNvbnRyb2xPcHRpb25zLFxuICBNYXBUeXBlQ29udHJvbE9wdGlvbnMsXG4gIE5hdmlnYXRpb25Db250cm9sT3B0aW9ucyxcbiAgT3ZlcnZpZXdNYXBDb250cm9sT3B0aW9ucyxcbiAgU2NhbGVDb250cm9sT3B0aW9uc1xufSBmcm9tICcuLi90eXBlcy9Db250cm9sJ1xuaW1wb3J0IHsgQkljb24sIEljb25PcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvSWNvbidcbmltcG9ydCB7IEJNYXJrZXJPcHRpb25zLCBNYXJrZXJPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvTWFya2VyJ1xuaW1wb3J0IHsgQlBvaW50LCBQb2ludCB9IGZyb20gJy4uL3R5cGVzL1BvaW50J1xuaW1wb3J0IHsgQlNpemUsIFNpemUgfSBmcm9tICcuLi90eXBlcy9TaXplJ1xuXG5pbXBvcnQgeyBpc051bGwgfSBmcm9tICcuL29iamVjdCdcbmltcG9ydCB7IEJNYXJrZXJDbHVzdGVyZXJPcHRpb25zLCBNYXJrZXJDbHVzdGVyZXJPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvTWFya2VyQ2x1c3RlcmVyJ1xuaW1wb3J0IHsgVGV4dEljb25TdHlsZSwgQlRleHRJY29uU3R5bGUgfSBmcm9tICcuLi90eXBlcy9UZXh0SWNvbk92ZXJsYXknXG5cbmV4cG9ydCBmdW5jdGlvbiB0b1BvaW50KG9wdHM6IFBvaW50KTogQlBvaW50IHtcbiAgaWYgKCFvcHRzKSB7XG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5Qb2ludCgpXG4gIH1cbiAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5Qb2ludChvcHRzLmxuZywgb3B0cy5sYXQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1BvaW50cyhvcHRzOiBBcnJheTxQb2ludD4pOiBBcnJheTxCUG9pbnQ+IHtcbiAgaWYgKCFvcHRzKSB7XG4gICAgcmV0dXJuIFtdXG4gIH1cbiAgcmV0dXJuIG9wdHMubWFwKHAgPT4ge1xuICAgIHJldHVybiBuZXcgd2luZG93LkJNYXAuUG9pbnQocC5sbmcsIHAubGF0KVxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9TaXplKG9wdHM6IFNpemUpOiBCU2l6ZSB7XG4gIGlmICghb3B0cykge1xuICAgIHJldHVybiBuZXcgd2luZG93LkJNYXAuU2l6ZSgpXG4gIH1cbiAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5TaXplKG9wdHMud2lkdGgsIG9wdHMuaGVpZ2h0KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9JY29uKHVybDogc3RyaW5nLCBzaXplOiBTaXplLCBvcHRpb25zOiBJY29uT3B0aW9ucyk6IEJJY29uIHtcbiAgaWYgKCFzaXplICYmICFvcHRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5JY29uKHVybClcbiAgfVxuICBpZiAoIXNpemUpIHtcbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLkljb24odXJsLCB0b1NpemUoc2l6ZSkpXG4gIH1cbiAgY29uc3QgaWNvbk9wdGlvbnM6IGFueSA9IHtcbiAgICBhbmNob3I6IHRvU2l6ZShvcHRpb25zLmFuY2hvciksXG4gICAgaW1hZ2VPZmZzZXQ6IHRvU2l6ZShvcHRpb25zLmltYWdlT2Zmc2V0KSxcbiAgICBpbmZvV2luZG93QW5jaG9yOiB0b1NpemUob3B0aW9ucy5pbmZvV2luZG93QW5jaG9yKSxcbiAgICBwcmludEltYWdlVXJsOiBvcHRpb25zLnByaW50SW1hZ2VVcmxcbiAgfVxuICBjb25zdCBpY29uID0gbmV3IHdpbmRvdy5CTWFwLkljb24odXJsLCB0b1NpemUoc2l6ZSksIGljb25PcHRpb25zKVxuICBpZiAob3B0aW9ucy5pbWFnZVNpemUpIHtcbiAgICBpY29uLnNldEltYWdlU2l6ZSh0b1NpemUob3B0aW9ucy5pbWFnZVNpemUpKVxuICB9XG4gIHJldHVybiBpY29uXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b01hcmtlck9wdGlvbnMob3B0aW9uczogTWFya2VyT3B0aW9ucyk6IEJNYXJrZXJPcHRpb25zIHtcbiAgY29uc3Qgb3B0czogQk1hcmtlck9wdGlvbnMgPSB7fVxuXG4gIGlmICghb3B0aW9ucykge1xuICAgIHJldHVybiBvcHRzXG4gIH1cblxuICBpZiAob3B0aW9ucy5vZmZzZXQpIHtcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcbiAgfVxuXG4gIGlmIChvcHRpb25zLmljb24pIHtcbiAgICBvcHRzLmljb24gPSB0b0ljb24ob3B0aW9ucy5pY29uLmltYWdlVXJsLCBvcHRpb25zLmljb24uc2l6ZSwgb3B0aW9ucy5pY29uKVxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMuZW5hYmxlTWFzc0NsZWFyKSkge1xuICAgIG9wdHMuZW5hYmxlTWFzc0NsZWFyID0gb3B0aW9ucy5lbmFibGVNYXNzQ2xlYXJcbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLmVuYWJsZURyYWdnaW5nKSkge1xuICAgIG9wdHMuZW5hYmxlRHJhZ2dpbmcgPSBvcHRpb25zLmVuYWJsZURyYWdnaW5nXG4gIH1cbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVDbGlja2luZykpIHtcbiAgICBvcHRzLmVuYWJsZUNsaWNraW5nID0gb3B0aW9ucy5lbmFibGVDbGlja2luZ1xuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMucmFpc2VPbkRyYWcpKSB7XG4gICAgb3B0cy5yYWlzZU9uRHJhZyA9IG9wdGlvbnMucmFpc2VPbkRyYWdcbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLmRyYWdnaW5nQ3Vyc29yKSkge1xuICAgIG9wdHMuZHJhZ2dpbmdDdXJzb3IgPSBvcHRpb25zLmRyYWdnaW5nQ3Vyc29yXG4gIH1cbiAgaWYgKCFpc051bGwob3B0aW9ucy5yb3RhdGlvbikpIHtcbiAgICBvcHRzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvblxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMudGl0bGUpKSB7XG4gICAgb3B0cy50aXRsZSA9IG9wdGlvbnMudGl0bGVcbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLnNoYWRvdykpIHtcbiAgICBvcHRzLnNoYWRvdyA9IHRvSWNvbihvcHRpb25zLnNoYWRvdy5pbWFnZVVybCwgb3B0aW9ucy5zaGFkb3cuc2l6ZSwgb3B0aW9ucy5zaGFkb3cpXG4gIH1cblxuICByZXR1cm4gb3B0c1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9OYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMob3B0aW9uczogTmF2aWdhdGlvbkNvbnRyb2xPcHRpb25zKTogQk5hdmlnYXRpb25Db250cm9sT3B0aW9ucyB7XG4gIGNvbnN0IG9wdHM6IEJOYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMgPSB7fVxuXG4gIGlmICghb3B0aW9ucykge1xuICAgIHJldHVybiBvcHRzXG4gIH1cblxuICBpZiAoIWlzTnVsbChvcHRpb25zLmFuY2hvcikpIHtcbiAgICBvcHRzLmFuY2hvciA9IG9wdGlvbnMuYW5jaG9yXG4gIH1cbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVHZW9sb2NhdGlvbikpIHtcbiAgICBvcHRzLmVuYWJsZUdlb2xvY2F0aW9uID0gb3B0aW9ucy5lbmFibGVHZW9sb2NhdGlvblxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMub2Zmc2V0KSkge1xuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMuc2hvd1pvb21JbmZvKSkge1xuICAgIG9wdHMuc2hvd1pvb21JbmZvID0gb3B0aW9ucy5zaG93Wm9vbUluZm9cbiAgfVxuXG4gIGlmICghaXNOdWxsKG9wdGlvbnMudHlwZSkpIHtcbiAgICBvcHRzLnR5cGUgPSBvcHRpb25zLnR5cGVcbiAgfVxuICByZXR1cm4gb3B0c1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9PdmVydmlld01hcENvbnRyb2xPcHRpb25zKG9wdGlvbnM6IE92ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMpOiBCT3ZlcnZpZXdNYXBDb250cm9sT3B0aW9ucyB7XG4gIGNvbnN0IG9wdHM6IEJPdmVydmlld01hcENvbnRyb2xPcHRpb25zID0ge31cblxuICBpZiAoIW9wdGlvbnMpIHtcbiAgICByZXR1cm4gb3B0c1xuICB9XG5cbiAgaWYgKCFpc051bGwob3B0aW9ucy5hbmNob3IpKSB7XG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMuaXNPcGVuKSkge1xuICAgIG9wdHMuaXNPcGVuID0gb3B0aW9ucy5pc09wZW5cbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLm9mZnNldCkpIHtcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLnNpemUpKSB7XG4gICAgb3B0cy5zaXplID0gdG9TaXplKG9wdGlvbnMuc2l6ZSlcbiAgfVxuICByZXR1cm4gb3B0c1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9TY2FsZUNvbnRyb2xPcHRpb25zKG9wdGlvbnM6IFNjYWxlQ29udHJvbE9wdGlvbnMpOiBCU2NhbGVDb250cm9sT3B0aW9ucyB7XG4gIGNvbnN0IG9wdHM6IEJTY2FsZUNvbnRyb2xPcHRpb25zID0ge31cblxuICBpZiAoIW9wdGlvbnMpIHtcbiAgICByZXR1cm4gb3B0c1xuICB9XG5cbiAgaWYgKCFpc051bGwob3B0aW9ucy5hbmNob3IpKSB7XG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMub2Zmc2V0KSkge1xuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxuICB9XG4gIHJldHVybiBvcHRzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b01hcFR5cGVDb250cm9sT3B0aW9ucyhvcHRpb25zOiBNYXBUeXBlQ29udHJvbE9wdGlvbnMpOiBCTWFwVHlwZUNvbnRyb2xPcHRpb25zIHtcbiAgY29uc3Qgb3B0czogQk1hcFR5cGVDb250cm9sT3B0aW9ucyA9IHt9XG5cbiAgaWYgKCFvcHRpb25zKSB7XG4gICAgcmV0dXJuIG9wdHNcbiAgfVxuXG4gIGlmICghaXNOdWxsKG9wdGlvbnMudHlwZSkpIHtcbiAgICBvcHRzLnR5cGUgPSBvcHRpb25zLnR5cGVcbiAgfVxuICByZXR1cm4gb3B0c1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvR2VvbG9jYXRpb25PcHRpb25zKG9wdGlvbnM6IEdlb2xvY2F0aW9uQ29udHJvbE9wdGlvbnMpOiBCR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyB7XG4gIGNvbnN0IG9wdHM6IEJHZW9sb2NhdGlvbkNvbnRyb2xPcHRpb25zID0ge31cblxuICBpZiAoIW9wdGlvbnMpIHtcbiAgICByZXR1cm4gb3B0c1xuICB9XG5cbiAgaWYgKCFpc051bGwob3B0aW9ucy5hbmNob3IpKSB7XG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMub2Zmc2V0KSkge1xuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMuZW5hYmxlQXV0b0xvY2F0aW9uKSkge1xuICAgIG9wdHMuZW5hYmxlQXV0b0xvY2F0aW9uID0gb3B0aW9ucy5lbmFibGVBdXRvTG9jYXRpb25cbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLmxvY2F0aW9uSWNvbikpIHtcbiAgICBvcHRzLmxvY2F0aW9uSWNvbiA9IHRvSWNvbihvcHRpb25zLmxvY2F0aW9uSWNvbi5pbWFnZVVybCwgb3B0aW9ucy5sb2NhdGlvbkljb24uc2l6ZSwgb3B0aW9ucy5sb2NhdGlvbkljb24pXG4gIH1cbiAgaWYgKCFpc051bGwob3B0aW9ucy5zaG93QWRkcmVzc0JhcikpIHtcbiAgICBvcHRzLnNob3dBZGRyZXNzQmFyID0gb3B0aW9ucy5zaG93QWRkcmVzc0JhclxuICB9XG4gIHJldHVybiBvcHRzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1RleHRJY29uU3R5bGUoc3R5bGU6IFRleHRJY29uU3R5bGUpOiBCVGV4dEljb25TdHlsZSB7XG4gIGNvbnN0IHJlYWxTdHlsZTogQlRleHRJY29uU3R5bGUgPSB7XG4gICAgdXJsOiBzdHlsZS51cmwsXG4gICAgc2l6ZTogdG9TaXplKHN0eWxlLnNpemUpXG4gIH1cbiAgaWYgKHN0eWxlLmFuY2hvcikge1xuICAgIHJlYWxTdHlsZS5hbmNob3IgPSB0b1NpemUoc3R5bGUuYW5jaG9yKVxuICB9XG4gIGlmIChzdHlsZS5vZmZzZXQpIHtcbiAgICByZWFsU3R5bGUub2Zmc2V0ID0gdG9TaXplKHN0eWxlLm9mZnNldClcbiAgfVxuICBpZiAoIWlzTnVsbChzdHlsZS50ZXh0U2l6ZSkpIHtcbiAgICByZWFsU3R5bGUudGV4dFNpemUgPSBzdHlsZS50ZXh0U2l6ZVxuICB9XG4gIGlmICghaXNOdWxsKHN0eWxlLnRleHRDb2xvcikpIHtcbiAgICByZWFsU3R5bGUudGV4dENvbG9yID0gc3R5bGUudGV4dENvbG9yXG4gIH1cblxuICByZXR1cm4gcmVhbFN0eWxlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b01hcmtlckNsdXN0ZXJlck9wdGlvbnMob3B0aW9uczogTWFya2VyQ2x1c3RlcmVyT3B0aW9ucyk6IEJNYXJrZXJDbHVzdGVyZXJPcHRpb25zIHtcbiAgY29uc3Qgb3B0czogQk1hcmtlckNsdXN0ZXJlck9wdGlvbnMgPSB7fVxuXG4gIGlmICghb3B0aW9ucykge1xuICAgIHJldHVybiBvcHRzXG4gIH1cblxuICBpZiAob3B0aW9ucy5tYXJrZXJzKSB7XG4gICAgb3B0cy5tYXJrZXJzID0gb3B0aW9ucy5tYXJrZXJzLm1hcChcbiAgICAgIG0gPT4gbmV3IHdpbmRvdy5CTWFwLk1hcmtlcih0b1BvaW50KG0ucG9pbnQpLCB0b01hcmtlck9wdGlvbnMobS5vcHRpb25zKSlcbiAgICApXG4gIH1cblxuICBpZiAoIWlzTnVsbChvcHRpb25zLmdpcmRTaXplKSkge1xuICAgIG9wdHMuZ2lyZFNpemUgPSBvcHRpb25zLmdpcmRTaXplXG4gIH1cbiAgaWYgKCFpc051bGwob3B0aW9ucy5tYXhab29tKSkge1xuICAgIG9wdHMubWF4Wm9vbSA9IG9wdGlvbnMubWF4Wm9vbVxuICB9XG4gIGlmICghaXNOdWxsKG9wdGlvbnMubWluQ2x1c3RlclNpemUpKSB7XG4gICAgb3B0cy5taW5DbHVzdGVyU2l6ZSA9IG9wdGlvbnMubWluQ2x1c3RlclNpemVcbiAgfVxuICBpZiAoIWlzTnVsbChvcHRpb25zLmlzQXZlcmFuZ2VDZW50ZXIpKSB7XG4gICAgb3B0cy5pc0F2ZXJhbmdlQ2VudGVyID0gb3B0aW9ucy5pc0F2ZXJhbmdlQ2VudGVyXG4gIH1cbiAgaWYgKG9wdGlvbnMuc3R5bGVzKSB7XG4gICAgb3B0cy5zdHlsZXMgPSBvcHRpb25zLnN0eWxlcy5maWx0ZXIocyA9PiBzKS5tYXAocyA9PiB0b1RleHRJY29uU3R5bGUocykpXG4gIH1cblxuICByZXR1cm4gb3B0c1xufVxuIl19